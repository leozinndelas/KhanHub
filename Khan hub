-- Criação da Interface Gráfica
local ScreenGui = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local AutoFarmButton = Instance.new("TextButton")
local FruitCollectorButton = Instance.new("TextButton")
local Signature = Instance.new("TextLabel")

ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
ScreenGui.Name = "ScriptUI"

Frame.Parent = ScreenGui
Frame.BackgroundColor3 = Color3.new(0, 0, 0)
Frame.Size = UDim2.new(0, 200, 0, 150)
Frame.Position = UDim2.new(0.1, 0, 0.1, 0)
Frame.BorderSizePixel = 0

AutoFarmButton.Parent = Frame
AutoFarmButton.Size = UDim2.new(0, 180, 0, 40)
AutoFarmButton.Position = UDim2.new(0, 10, 0, 10)
AutoFarmButton.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
AutoFarmButton.TextColor3 = Color3.new(1, 1, 1)
AutoFarmButton.Text = "Toggle Auto-Farm"

FruitCollectorButton.Parent = Frame
FruitCollectorButton.Size = UDim2.new(0, 180, 0, 40)
FruitCollectorButton.Position = UDim2.new(0, 10, 0, 60)
FruitCollectorButton.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
FruitCollectorButton.TextColor3 = Color3.new(1, 1, 1)
FruitCollectorButton.Text = "Toggle Fruit Collector"

Signature.Parent = Frame
Signature.Size = UDim2.new(0, 180, 0, 20)
Signature.Position = UDim2.new(0, 10, 0, 110)
Signature.BackgroundTransparency = 1
Signature.TextColor3 = Color3.new(1, 1, 1)
Signature.Text = "KhanHub-by leozin"
Signature.TextScaled = true

-- Configuração das Funções
local autoFarmActive = false
local fruitCollectorActive = false

local function toggleAutoFarm()
    autoFarmActive = not autoFarmActive
    AutoFarmButton.BackgroundColor3 = autoFarmActive and Color3.new(0, 1, 0) or Color3.new(1, 0, 0)
    AutoFarmButton.Text = autoFarmActive and "Auto-Farm: ON" or "Auto-Farm: OFF"
    if autoFarmActive then
        print("Auto-Farm ativado")
        spawn(autoFarm)
    else
        print("Auto-Farm desativado")
    end
end

local function toggleFruitCollector()
    fruitCollectorActive = not fruitCollectorActive
    FruitCollectorButton.BackgroundColor3 = fruitCollectorActive and Color3.new(0, 1, 0) or Color3.new(1, 0, 0)
    FruitCollectorButton.Text = fruitCollectorActive and "Fruit Collector: ON" or "Fruit Collector: OFF"
    if fruitCollectorActive then
        print("Fruit Collector ativado")
        spawn(fruitCollector)
    else
        print("Fruit Collector desativado")
    end
end

-- Conexão dos Botões
AutoFarmButton.MouseButton1Click:Connect(toggleAutoFarm)
FruitCollectorButton.MouseButton1Click:Connect(toggleFruitCollector)

-- Funções de Automação
local function autoFarm()
    while autoFarmActive do
        local player = game.Players.LocalPlayer
        local playerLevel = player.Data.Level.Value -- Verifica o nível do jogador
        local questGiver, questLocation, mobLocation = getQuestAndMobForLevel(playerLevel)

        -- Pega a Quest
        teleportTo(questLocation)
        wait(2)
        fireclickdetector(questGiver:FindFirstChild("ClickDetector"))

        -- Ataca os mobs do nível
        teleportTo(mobLocation)
        wait(2)
        local mobs = getMobsNearby(mobLocation)
        for _, mob in pairs(mobs) do
            while mob.Humanoid.Health > 0 and autoFarmActive do
                attackMob(mob)
                wait(0.5)
            end
        end
        wait(5)
    end
end

local function fruitCollector()
    while fruitCollectorActive do
        local fruits = detectFruits()
        for _, fruit in pairs(fruits) do
            collectFruit(fruit)
        end
        wait(5)
    end
end

-- Funções Auxiliares
local function teleportTo(location)
    if game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(location)
    end
end

local function detectFruits()
    local fruits = {}
    for _, item in pairs(game.Workspace:GetChildren()) do
        if item:IsA("Tool") and item:FindFirstChild("Handle") and item.Name:lower():find("fruit") then
            table.insert(fruits, item)
        end
    end
    return fruits
end

local function collectFruit(fruit)
    if fruit and fruit:FindFirstChild("Handle") then
        pcall(function()
            teleportTo(fruit.Handle.Position)
            wait(math.random(1, 2)) -- Simula um atraso realista
            fireclickdetector(fruit.Handle:FindFirstChild("ClickDetector"))
        end)
    end
end

local function getQuestAndMobForLevel(playerLevel)
    if playerLevel < 50 then
        return game.Workspace.QuestGiver1, Vector3.new(100, 10, 200), Vector3.new(120, 10, 220)
    elseif playerLevel < 100 then
        return game.Workspace.QuestGiver2, Vector3.new(300, 10, 400), Vector3.new(320, 10, 420)
    else
        return game.Workspace.QuestGiver3, Vector3.new(500, 10, 600), Vector3.new(520, 10, 620)
    end
end

local function getMobsNearby(location)
    local mobs = {}
    for _, mob in pairs(game.Workspace:GetChildren()) do
        if mob:IsA("Model") and mob:FindFirstChild("Humanoid") and mob.Humanoid.Health > 0 then
            local mobPosition = mob:FindFirstChild("HumanoidRootPart") and mob.HumanoidRootPart.Position
            if mobPosition and (mobPosition - location).Magnitude < 50 then
                table.insert(mobs, mob)
            end
        end
    end
    return mobs
end

local function attackMob(mob)
    local character = game.Players.LocalPlayer.Character
    if character and character:FindFirstChild("HumanoidRootPart") and mob:FindFirstChild("HumanoidRootPart") then
        character.HumanoidRootPart.CFrame = mob.HumanoidRootPart.CFrame
        wait(0.2)
        -- Simula o ataque (modifique conforme necessário para a lógica de ataque)
        fireclickdetector(mob:FindFirstChild("ClickDetector"))
    end
end
