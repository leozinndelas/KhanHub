-- Interface Gráfica
local ScreenGui = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local AutoFarmButton = Instance.new("TextButton")

ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
ScreenGui.Name = "KhanHub-by leozin"

Frame.Parent = ScreenGui
Frame.BackgroundColor3 = Color3.new(0, 0, 0)
Frame.Size = UDim2.new(0, 200, 0, 100)
Frame.Position = UDim2.new(0.1, 0, 0.1, 0)
Frame.BorderSizePixel = 0

AutoFarmButton.Parent = Frame
AutoFarmButton.Size = UDim2.new(0, 180, 0, 40)
AutoFarmButton.Position = UDim2.new(0, 10, 0, 10)
AutoFarmButton.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
AutoFarmButton.TextColor3 = Color3.new(1, 1, 1)
AutoFarmButton.Text = "Toggle Auto-Farm"

-- Variáveis e Funções Globais
local autoFarmActive = false

local function toggleAutoFarm()
    autoFarmActive = not autoFarmActive
    if autoFarmActive then
        print("Auto-Farm ativado.")
        spawn(autoFarm)
    else
        print("Auto-Farm desativado.")
    end
end

AutoFarmButton.MouseButton1Click:Connect(toggleAutoFarm)

-- Função de Auto-Farm
local function autoFarm()
    while autoFarmActive do
        local player = game.Players.LocalPlayer
        if not player then
            warn("Jogador não encontrado.")
            break
        end

        local character = player.Character or player.CharacterAdded:Wait()
        local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
        if not humanoidRootPart then
            warn("HumanoidRootPart não encontrado.")
            break
        end

        -- Obtém o nível do jogador
        local playerLevel = player:FindFirstChild("Data") and player.Data:FindFirstChild("Level") and player.Data.Level.Value
        if not playerLevel then
            warn("Nível do jogador não encontrado.")
            break
        end

        print("Nível do jogador:", playerLevel)

        -- Localiza o NPC de missão e os mobs correspondentes
        local questGiver, questLocation, mobLocation = getQuestAndMobForLevel(playerLevel)
        if not questGiver or not questLocation or not mobLocation then
            warn("Nenhuma missão ou mob disponível para o nível atual.")
            break
        end

        -- Aceita a missão
        teleportTo(questLocation)
        wait(1)
        if questGiver:FindFirstChild("ClickDetector") then
            fireclickdetector(questGiver.ClickDetector)
            print("Missão aceita.")
        else
            warn("ClickDetector não encontrado no NPC.")
        end

        -- Ataca os mobs
        teleportTo(mobLocation)
        wait(1)
        local mobs = getMobsNearby(mobLocation)
        if #mobs > 0 then
            for _, mob in pairs(mobs) do
                print("Atacando mob:", mob.Name)
                while mob:FindFirstChild("Humanoid") and mob.Humanoid.Health > 0 and autoFarmActive do
                    humanoidRootPart.CFrame = mob.HumanoidRootPart.CFrame + Vector3.new(0, 5, 0)
                    attackMob(mob)
                    wait(0.5)
                end
            end
        else
            warn("Nenhum mob encontrado.")
        end

        wait(5)
    end
end

-- Funções Auxiliares
local function teleportTo(location)
    local character = game.Players.LocalPlayer.Character
    if character and character:FindFirstChild("HumanoidRootPart") then
        character.HumanoidRootPart.CFrame = CFrame.new(location)
    else
        warn("Não foi possível teleportar.")
    end
end

local function getQuestAndMobForLevel(level)
    -- Retorna as posições com base no nível
    if level < 50 then
        return game.Workspace:FindFirstChild("QuestGiver1"), Vector3.new(100, 10, 200), Vector3.new(120, 10, 220)
    elseif level < 100 then
        return game.Workspace:FindFirstChild("QuestGiver2"), Vector3.new(300, 10, 400), Vector3.new(320, 10, 420)
    else
        return game.Workspace:FindFirstChild("QuestGiver3"), Vector3.new(500, 10, 600), Vector3.new(520, 10, 620)
    end
end

local function getMobsNearby(location)
    local mobs = {}
    for _, mob in pairs(game.Workspace:GetChildren()) do
        if mob:IsA("Model") and mob:FindFirstChild("Humanoid") and mob.Humanoid.Health > 0 then
            local mobPosition = mob:FindFirstChild("HumanoidRootPart") and mob.HumanoidRootPart.Position
            if mobPosition and (mobPosition - location).Magnitude < 50 then
                table.insert(mobs, mob)
            end
        end
    end
    return mobs
end

local function attackMob(mob)
    local character = game.Players.LocalPlayer.Character
    if character and character:FindFirstChild("HumanoidRootPart") and mob:FindFirstChild("HumanoidRootPart") then
        character.HumanoidRootPart.CFrame = mob.HumanoidRootPart.CFrame + Vector3.new(0, 5, 0)
        wait(0.1)
        print("Atacando mob:", mob.Name)
        -- Simulação de ataque
    else
        warn("Não foi possível atacar.")
    end
end
